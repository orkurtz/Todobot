# ğŸ¤– WhatsApp Todo Bot

<div align="center">
  <img src="assets/images/todo.png" alt="WhatsApp Todo Bot" width="400">
  
  <p><strong>An intelligent AI-powered personal assistant that helps you manage tasks and stay organized through WhatsApp.</strong></p>
  
  <p>The bot understands natural Hebrew and English language, extracts actionable tasks from text AND voice messages, and provides smart reminders optimized for Israeli users.</p>

  <p>
    <a href="#-try-it-now---live-demo"><strong>ğŸš€ Try Now</strong></a> â€¢
    <a href="#-demo"><strong>Demo</strong></a> â€¢
    <a href="#-quick-start"><strong>Get Started</strong></a> â€¢
    <a href="#-features"><strong>Features</strong></a> â€¢
    <a href="#-usage"><strong>Usage</strong></a> â€¢
    <a href="#-deployment"><strong>Deploy</strong></a>
  </p>

  <p>
    <img src="https://img.shields.io/badge/Python-3.8+-blue?style=for-the-badge&logo=python" alt="Python">
    <img src="https://img.shields.io/badge/Flask-Framework-green?style=for-the-badge&logo=flask" alt="Flask">
    <img src="https://img.shields.io/badge/WhatsApp-Business%20API-25D366?style=for-the-badge&logo=whatsapp" alt="WhatsApp">
    <img src="https://img.shields.io/badge/AI-Google%20Gemini%202.5%20Flash-4285F4?style=for-the-badge&logo=google" alt="Google Gemini">
  </p>
  
  <p>
    <a href="https://wa.me/972559664336" target="_blank">
      <img src="https://img.shields.io/badge/ğŸš€_TRY_LIVE_DEMO-FF6B6B?style=for-the-badge&logoColor=white&logo=whatsapp" alt="Try Live Demo">
    </a>
  </p>
</div>

---

## ğŸ“± Demo

<div align="center">
  <h3>See WhatsApp Todo Bot in Action</h3>
  
  <table>
    <tr>
      <td align="center">
        <strong>ğŸ“ Natural Language Input</strong><br>
        <em>"Call mom tomorrow at 3pm"</em><br>
        <em>"×ª×–×›×™×¨ ×œ×™ ×œ×§× ×•×ª ×—×œ×‘ ×‘×¢×•×“ 10 ×“×§×•×ª"</em><br>
        <em>ğŸ¤ Voice: "×¤×’×™×©×” ×¢× ×™×•×—× ×Ÿ ××—×¨ ×‘×‘×•×§×¨"</em>
      </td>
      <td align="center">
        <strong>ğŸ¤– AI Processing</strong><br>
        âœ… Task extracted<br>
        ğŸ“… Due date parsed (Hebrew & English)<br>
        ğŸ¤ Voice transcribed & understood<br>
        ğŸ”” Reminder scheduled
      </td>
      <td align="center">
        <strong>ğŸ“² WhatsApp Response</strong><br>
        <em>"× ×•×¦×¨×” ××©×™××”: Call mom"</em><br>
        <em>"ğŸ¤ ×©××¢×ª×™: '×œ×§× ×•×ª ×—×œ×‘'"</em><br>
        <em>"âœ… ×ª×–×›×•×¨×ª × ×§×‘×¢×” ×œ-14:30"</em>
      </td>
    </tr>
  </table>

  <p><strong>ğŸ‡®ğŸ‡± Hebrew Language Support:</strong> Optimized for Hebrew speakers with Israeli timezone!</p>
  <p><strong>ğŸ¤ Voice Message Support:</strong> Send voice notes in Hebrew or English - they'll be transcribed and understood!</p>
  
  <p>
    <a href="https://wa.me/972559664336" target="_blank">
      <img src="https://img.shields.io/badge/ğŸ’¬_Try_Live_Demo-25D366?style=for-the-badge&logo=whatsapp&logoColor=white" alt="Try Live Demo">
    </a>
  </p>
  
  <p><em>Click above to test the bot directly on WhatsApp! Just send a text message like "×œ×§× ×•×ª ×—×œ×‘ ××—×¨ ×‘×—××©" or a voice note and see the magic happen! âœ¨</em></p>
</div>

## ğŸš€ Try It Now - Live Demo!

<div align="center">
  <h3>ğŸ¯ Ready to experience the magic? Test our live WhatsApp Todo Bot!</h3>
  
  <p>
    <a href="https://wa.me/972559664336?text=×©×œ×•×%20×‘×•×˜%20×”××©×™××•×ª!%20×× ×™%20×¨×•×¦×”%20×œ× ×¡×•×ª%20××•×ª×š." target="_blank">
      <img src="https://img.shields.io/badge/ğŸ’¬%20Start%20Chat%20Now-25D366?style=for-the-badge&logo=whatsapp&logoColor=white&labelColor=25D366" alt="Start WhatsApp Chat" height="60">
    </a>
  </p>
  
  <h4>ğŸ“ Try These Example Messages:</h4>
  <table>
    <tr>
      <td><strong>ğŸ“ Basic Tasks</strong></td>
      <td><strong>â° With Relative Times</strong></td>
      <td><strong>ğŸ”§ Task Management</strong></td>
    </tr>
    <tr>
      <td>
        â€¢ "×œ×§× ×•×ª ×—×œ×‘ ××—×¨"<br>
        â€¢ "×¤×’×™×©×” ×¢× ×× ×”×œ ×‘×™×•× ×¨××©×•×Ÿ"<br>
        â€¢ ğŸ¤ <em>Voice: "×œ×”×ª×§×©×¨ ×œ×××"</em><br>
        â€¢ "Meeting with John next Monday"
      </td>
      <td>
        â€¢ "×ª×–×›×™×¨ ×œ×™ ×‘×¢×•×“ 5 ×“×§×•×ª"<br>
        â€¢ "×“×—×” ××©×™××” 2 ×‘×©×¢×ª×™×™×"<br>
        â€¢ "remind me in 10 minutes"<br>
        â€¢ "×”×¢×‘×¨ ××©×™××” 3 ×œ××—×¨ ×‘-15:00"
      </td>
      <td>
        â€¢ "×¡×™×™××ª×™ ××©×™××” 2"<br>
        â€¢ "×©× ×” ××©×™××” 1 ×œ×§× ×•×ª ×œ×—×"<br>
        â€¢ "×”××©×™××•×ª ×©×œ×™"<br>
        â€¢ "×¡×˜×˜×™×¡×˜×™×§×”"<br>
        â€¢ "×¢×–×¨×”"
      </td>
    </tr>
  </table>
  
  <p><strong>âš¡ What happens next?</strong><br>
  The bot will instantly parse your message (text or voice!), extract tasks, understand due dates in Hebrew or English, and create reminders - all through natural conversation!</p>
  
  <p><em>ğŸ’¡ Tip: Try sending a voice message in Hebrew - the bot transcribes AND understands it!</em></p>
</div>

---

## âœ¨ Features

### ğŸ¯ Smart Task Management
- **Natural Language Processing**: Just tell the bot what you need to do (text or voice!)
- **Automatic Task Extraction**: AI identifies actionable items from your messages
- **Voice Message Support**: ğŸ¤ Send voice notes in Hebrew or English - automatic transcription + task extraction
- **Task Updates**: Change task descriptions with `"×©× ×” ××©×™××” 2 ×œ×”×ª×§×©×¨ ×œ×¨×•×¤×"`
- **Task Rescheduling**: Move due dates with `"×“×—×” ××©×™××” 3 ×œ××—×¨"` or `"postpone task 5 by 2 hours"`
- **Task Status Tracking**: Pending, completed, and progress tracking
- **Smart Task Queries**: Ask questions like `"××ª×™ ×”×¤×’×™×©×” ×¢× ×™×•×—× ×Ÿ?"` and get real-time answers

### â±ï¸ Advanced Date & Time Understanding
- **Hebrew Relative Times**: `"×‘×¢×•×“ 5 ×“×§×•×ª"`, `"×‘×¢×•×“ ×©×¢×ª×™×™×"`, `"×‘×¢×•×“ ×©×‘×•×¢"`
- **English Relative Times**: `"in 2 minutes"`, `"in half an hour"`, `"next week"`
- **Hebrew Dates**: `"×”×™×•×"`, `"××—×¨"`, `"××—×¨×ª×™×™×"`, `"×™×•× ×¨××©×•×Ÿ"`
- **English Dates**: `"today"`, `"tomorrow"`, `"next Monday at 3pm"`
- **Exact Times**: `"××—×¨ ×‘-15:00"`, `"tomorrow at 3pm"`

### ğŸ‡®ğŸ‡± Hebrew Language Optimization
- **Natural Hebrew**: ××‘×™×Ÿ ×¢×‘×¨×™×ª ×‘×¦×•×¨×” ×˜×‘×¢×™×ª ×•××“×•×™×§×ª
- **Israeli Context**: ××•×ª×× ×œ×–××Ÿ ×™×©×¨××œ×™ ×•×ª×¨×‘×•×ª ××§×•××™×ª
- **Hebrew Date Parsing**: ××‘×™×Ÿ ×ª××¨×™×›×™× ×‘×¢×‘×¨×™×ª ×›××• "×”×™×•×", "××—×¨", "×‘×¢×•×“ ×©×¢×”"
- **Local Timezone**: ×¢×•×‘×“ ×œ×¤×™ ×©×¢×•×Ÿ ×™×©×¨××œ (Asia/Jerusalem)

### ğŸ¤ Voice Message Features
- **Automatic Transcription**: Voice-to-text in Hebrew and English
- **Direct Task Extraction**: AI understands tasks from voice in one go
- **Powered by Gemini 2.5 Flash**: Latest Google AI for multimodal processing
- **No External Services**: All processing happens in one API call

### ğŸ›¡ï¸ Reliability & Performance
- **Circuit Breaker Pattern**: Automatic API failure detection and recovery
- **Advanced Rate Limiting**: Multi-tier protection (per minute/hour/day)
- **Redis-Backed Caching**: Fast and reliable with fallback to in-memory storage
- **Exponential Backoff**: Automatic retry logic for transient failures
- **Robust Error Handling**: Graceful degradation and user-friendly error messages

### ğŸ”’ Privacy & Security
- **End-to-End Encryption**: All user data encrypted at rest (AES-256)
- **No Data Mining**: Your conversations are private and secure
- **GDPR Compliant**: Built with privacy regulations in mind
- **Secure Hash Lookups**: Phone numbers hashed for database searches

### ğŸ“Š Productivity Insights
- **Statistics Dashboard**: Track your productivity over time
- **Completion Rates**: See how well you're doing with your goals
- **Usage Analytics**: Understand your task management patterns
- **Due Date Tracking**: Overdue and today's tasks highlighted

## ğŸš€ Quick Start

### Prerequisites
- Python 3.8+
- PostgreSQL database
- Redis (optional, for caching and rate limiting)
- WhatsApp Business API access
- Google Gemini API key

### Installation

1. **Clone the repository**
   ```bash
   git clone https://github.com/buzagloidan/Todobot.git
   cd Todobot
   ```

2. **Create virtual environment**
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. **Install dependencies**
   ```bash
   pip install -r requirements.txt
   ```

4. **Set up environment variables**
   ```bash
   cp .env.example .env
   # Edit .env with your configuration (including hidden files like .env)
   ```

5. **Initialize database**
   ```bash
   flask db init
   flask db migrate -m "Initial migration"
   flask db upgrade
   ```

6. **Run the application**
   ```bash
   python app.py
   ```

## âš™ï¸ Configuration

### Environment Variables

Create a `.env` file with the following variables:

```env
# Flask Configuration
FLASK_ENV=production
SECRET_KEY=your-secret-key-here

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/whatsapp_todo

# WhatsApp API
WHATSAPP_TOKEN=your-whatsapp-business-api-token
WEBHOOK_VERIFY_TOKEN=your-webhook-verify-token

# Google Gemini AI (2.5 Flash)
GEMINI_API_KEY=your-gemini-api-key

# Redis (Optional but recommended for rate limiting)
REDIS_URL=redis://localhost:6379

# Encryption
ENCRYPTION_KEY=your-base64-encryption-key

# Rate Limiting (API protection)
RATE_LIMIT_REQUESTS_PER_MINUTE=30
RATE_LIMIT_REQUESTS_PER_HOUR=1000
RATE_LIMIT_REQUESTS_PER_DAY=10000
```

### WhatsApp Business API Setup

1. Create a WhatsApp Business account
2. Set up webhook URL: `https://yourdomain.com/webhook`
3. Configure webhook verification token
4. Add your phone number to the allowed list

## ğŸ“ Project Structure

```
Todobot/
â”œâ”€â”€ src/                    # Source code
â”‚   â”œâ”€â”€ models/            # Database models
â”‚   â”‚   â””â”€â”€ database.py    # SQLAlchemy models with encryption
â”‚   â”œâ”€â”€ services/          # Business logic services
â”‚   â”‚   â”œâ”€â”€ ai_service.py      # AI/Gemini integration (with voice support)
â”‚   â”‚   â”œâ”€â”€ whatsapp_service.py # WhatsApp API client
â”‚   â”‚   â”œâ”€â”€ task_service.py     # Task management (CRUD + update/reschedule)
â”‚   â”‚   â”œâ”€â”€ encryption.py      # Data encryption (AES-256)
â”‚   â”‚   â”œâ”€â”€ scheduler_service.py # Background task scheduling
â”‚   â”‚   â””â”€â”€ monitoring_service.py # System monitoring
â”‚   â”œâ”€â”€ utils/             # Utility functions
â”‚   â”‚   â”œâ”€â”€ rate_limiter.py    # Rate limiting (Redis-backed)
â”‚   â”‚   â”œâ”€â”€ circuit_breaker.py # Circuit breaker pattern
â”‚   â”‚   â”œâ”€â”€ media_handler.py   # WhatsApp media downloads
â”‚   â”‚   â””â”€â”€ validation.py      # Input validation
â”‚   â”œâ”€â”€ routes/            # Flask routes
â”‚   â”‚   â”œâ”€â”€ webhook.py     # WhatsApp webhook handler (text + voice)
â”‚   â”‚   â”œâ”€â”€ admin.py       # Admin dashboard
â”‚   â”‚   â””â”€â”€ api.py         # REST API endpoints
â”‚   â”œâ”€â”€ config/            # Configuration
â”‚   â”‚   â””â”€â”€ settings.py    # App configuration
â”‚   â””â”€â”€ app.py            # Flask application factory
â”œâ”€â”€ app.py                # Main application entry point
â”œâ”€â”€ worker_simple.py      # Background worker process
â”œâ”€â”€ requirements.txt      # Python dependencies
â”œâ”€â”€ Procfile             # Railway/Heroku deployment
â””â”€â”€ README.md            # This file
```

## ğŸ”§ Usage

### Basic Commands

Send these messages to the bot:

- `×¢×–×¨×”` or `help` - Get help and available commands
- `××©×™××•×ª` or `×”××©×™××•×ª ×©×œ×™` - View your pending tasks
- `×¡×˜×˜×™×¡×˜×™×§×”` or `stats` - See your productivity statistics
- `×”×•×©×œ××•` or `completed` - View recently completed tasks

### Natural Language Examples

#### ğŸ“ Hebrew Text Examples
- **Create Tasks:**
  - "×œ×”×ª×§×©×¨ ×œ××× ××—×¨ ×‘-15:00"
  - "×œ×§× ×•×ª ××¦×¨×›×™× ×”×™×•×"
  - "×¤×’×™×©×” ×¢× ×™×•×—× ×Ÿ ×‘×™×•× ×¨××©×•×Ÿ ×‘-10:00"
  - "×ª×–×›×™×¨ ×œ×™ ×‘×¢×•×“ 5 ×“×§×•×ª ×œ×¦××ª"
  - "×‘×¢×•×“ ×©×¢×” ×ª×–×›×™×¨ ×œ×™ ×œ×¡×’×•×¨ ××ª ×”××—×©×‘"

- **Update Tasks:**
  - "×©× ×” ××©×™××” 2 ×œ×”×ª×§×©×¨ ×œ×¨×•×¤×"
  - "×¢×“×›×Ÿ ××©×™××” 3 ×§× ×” ×œ×—×"

- **Reschedule Tasks:**
  - "×“×—×” ××©×™××” 1 ×œ××—×¨"
  - "×”×¢×‘×¨ ××©×™××” 2 ×‘×¢×•×“ ×©×¢×ª×™×™×"
  - "×“×—×” 3 ×‘×™×•××™×™×"

- **Complete Tasks:**
  - "×¡×™×™××ª×™ ××©×™××” 2"
  - "×’××¨×ª×™ ××ª 1"

#### ğŸ¤ Hebrew Voice Examples
- **Send voice notes saying:**
  - "×ª×–×›×™×¨ ×œ×™ ×œ×§× ×•×ª ×—×œ×‘ ××—×¨ ×‘×©×¢×” ×—××©"
  - "×¡×™×™××ª×™ ××ª ××©×™××” ×©×ª×™×™×"
  - "×¤×’×™×©×” ×¢× ×”×¨×•×¤× ×‘×™×•× ×¨×‘×™×¢×™ ×‘×¢×©×¨"
  - "×‘×¢×•×“ ×¢×©×¨ ×“×§×•×ª ×ª×–×›×™×¨ ×œ×™ ×œ×¦××ª ××”×‘×™×ª"

#### ğŸ“ English Text Examples
- "remind me in 2 minutes to call John"
- "meeting with Sarah tomorrow at 3pm"
- "postpone task 2 by 2 hours"
- "change task 1 to buy bread"

#### ğŸ¤ English Voice Examples
- **Send voice notes saying:**
  - "remind me to call mom tomorrow at three PM"
  - "done with task number two"

### Task Management Actions

#### âœ… Complete Tasks
- React with ğŸ‘ to any message
- "×¡×™×™××ª×™ ××©×™××” 2" / "done with task 2"
- "×’××¨×ª×™ ××ª 1" / "finished 1"

#### ğŸ“ Update Tasks
- "×©× ×” ××©×™××” 3 ×œ×”×ª×§×©×¨ ×œ×¨×•×¤×" (change description)
- "×¢×“×›×Ÿ ××©×™××” 5 ×§× ×” ×—×œ×‘ ××—×¨ ×‘-10" (change description + due date)

#### â° Reschedule Tasks
- "×“×—×” ××©×™××” 2 ×œ××—×¨" / "postpone task 2 to tomorrow"
- "×”×¢×‘×¨ ××©×™××” 1 ×‘×¢×•×“ ×©×¢×ª×™×™×" / "move task 1 in 2 hours"
- "×“×—×” 3 ×œ×™×•× ×©×œ×™×©×™" / "reschedule 3 to Tuesday"

#### â“ Query Tasks
- "××ª×™ ×”×¤×’×™×©×” ×¢× ×™×•×—× ×Ÿ?" / "when is the meeting with John?"
- "×›××” ××©×™××•×ª ×™×© ×œ×™?" / "how many tasks do I have?"

### Task Reminders

- Tasks with due dates will send reminders 15 minutes before
- Overdue tasks are highlighted with âš ï¸
- Tasks due today show ğŸ”¥

## ğŸš€ Deployment

### Railway (Recommended)

1. Connect your GitHub repository to Railway
2. Set environment variables in Railway dashboard
3. Deploy automatically with git push
4. Enable Redis add-on for rate limiting

### Docker

```bash
# Build image
docker build -t whatsapp-todo-bot .

# Run container
docker run -d --name todo-bot -p 5000:5000 --env-file .env whatsapp-todo-bot
```

## ğŸ”§ Development

### Running Tests

```bash
# Install development dependencies
pip install -r requirements-dev.txt

# Run tests
python -m pytest tests/

# Run with coverage
python -m pytest tests/ --cov=src/
```

### Code Quality

```bash
# Format code
black src/ tests/

# Lint code
flake8 src/ tests/

# Type checking
mypy src/
```

### Database Migrations

```bash
# Create migration
flask db migrate -m "Description of changes"

# Apply migration
flask db upgrade

# Rollback migration
flask db downgrade
```

## ğŸ“Š Monitoring

### Health Checks

- **Application Health**: `GET /admin/health`
- **API Health**: `GET /api/health`
- **Metrics**: `GET /api/metrics` (Prometheus format)

### Admin Dashboard

Access the admin dashboard at `/admin/dashboard` to monitor:

- User statistics
- Message volume (text + voice)
- Task completion rates
- System health status
- API rate limit usage
- Circuit breaker status

## ğŸ” Security

### Data Protection

- All user data encrypted using AES-256
- Phone numbers hashed for lookups
- Messages encrypted at rest
- No conversation data logged
- Voice messages processed and immediately discarded

### API Protection

- Circuit breaker pattern for API resilience
- Multi-tier rate limiting (minute/hour/day)
- Redis-backed rate limit tracking
- Exponential backoff for retries
- Input validation and sanitization

### Best Practices

- Use HTTPS in production
- Regularly rotate encryption keys
- Monitor for suspicious activity
- Keep dependencies updated

## ğŸ› Troubleshooting

### Common Issues

1. **Voice Message Processing Failures**
   ```bash
   # Check WhatsApp media permissions
   # Verify WHATSAPP_TOKEN has media download rights
   # Check Gemini API quota for multimodal requests
   ```

2. **Database Connection Issues**
   ```bash
   # Check database connection
   python -c "from src.models.database import db; print('Connected')"
   ```

3. **WhatsApp API Issues**
   - Verify webhook URL is accessible
   - Check token permissions
   - Ensure phone number is verified

4. **AI Service Issues**
   - Verify Gemini API key is valid
   - Check API quota limits
   - Monitor rate limiting and circuit breaker status

### Logs

Application logs include:
- Request/response details
- Voice transcription results
- Task extraction results
- Error messages with context
- Performance metrics
- Circuit breaker state changes
- Rate limit violations

## ğŸ†• What's New

### Recent Updates (Past 3 Days)

#### ğŸ¤ Voice Message Support (NEW!)
- Full voice message transcription using Gemini 2.5 Flash multimodal API
- Automatic task extraction from Hebrew and English voice notes
- Single API call for transcription + task parsing
- Media download handler for WhatsApp audio files

#### â° Advanced Time Parsing (NEW!)
- Hebrew relative times: "×‘×¢×•×“ 5 ×“×§×•×ª", "×‘×¢×•×“ ×©×¢×ª×™×™×"
- English relative times: "in 2 minutes", "in half an hour"
- Enhanced natural language understanding for dates

#### ğŸ”„ Task Update & Reschedule (NEW!)
- Update task descriptions: "×©× ×” ××©×™××” 2 ×œ×”×ª×§×©×¨ ×œ×¨×•×¤×"
- Reschedule tasks: "×“×—×” ××©×™××” 3 ×œ××—×¨"
- Combined updates: change description + due date together

#### ğŸ›¡ï¸ Reliability Improvements (NEW!)
- Circuit breaker pattern for API failure recovery
- Advanced rate limiting with Redis backend
- Improved JSON parsing from AI responses
- Better error handling throughout

#### ğŸ¤– AI Enhancements (NEW!)
- Upgraded to Gemini 2.5 Flash model
- Better prompt engineering for task actions
- Support for task queries with real-time database results
- Fixed JSON parsing issues with code blocks

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ğŸ™ Acknowledgments

- [Google Gemini 2.5 Flash](https://ai.google.dev/) for powerful AI capabilities (text + voice)
- [WhatsApp Business API](https://developers.facebook.com/docs/whatsapp) for messaging platform
- [Flask](https://flask.palletsprojects.com/) for the web framework
- [SQLAlchemy](https://www.sqlalchemy.org/) for database management
- [Redis](https://redis.io/) for caching and rate limiting

---

<div align="center">
  <p>Made with â¤ï¸ for Israeli productivity enthusiasts</p>
  
  <p>
    <a href="https://wa.me/972559664336?text=×©×œ×•×!%20××¦××ª×™%20××ª%20×”×‘×•×˜%20×©×œ×š%20×‘-GitHub!" target="_blank">
      <img src="https://img.shields.io/badge/ğŸ’¬%20Chat%20with%20Bot-25D366?style=flat&logo=whatsapp" alt="Chat with Bot">
    </a>
    <img src="https://img.shields.io/badge/Made%20with-â¤ï¸-red?style=flat" alt="Made with Love">
    <img src="https://img.shields.io/badge/Open%20Source-âœ¨-blue?style=flat" alt="Open Source">
    <img src="https://img.shields.io/badge/Voice%20Enabled-ğŸ¤-purple?style=flat" alt="Voice Enabled">
  </p>
  
  <p><em>â­ Star this repo if you find it useful!</em></p>
</div>
